version: "1.0"
meta:
  name: "Stratos Brain Backtest Setups (Project Apex)"
  created_at: "2026-01-25"
  description: >
    The 7 Master Setups for the "Classify First, Grade Second" system.
    These setups are mathematically defined and backtested before being
    passed to the AI for quality grading.

# =============================================================================
# SETUP DEFINITIONS
# =============================================================================
# Each setup defines:
#   - name: Unique identifier
#   - description: Human-readable explanation
#   - parameters: Tunable values (can be overridden at runtime)
#   - entry_conditions: Gate logic for identifying entry points
#   - direction: 'long' (default) or 'short'
# =============================================================================

setups:

  # ===========================================================================
  # TREND CONTINUATION SETUPS
  # ===========================================================================

  - name: "pullback_ma50"
    description: >
      The Pullback: Strong trend dips to a moving average on light volume.
      High win rate setup for trend-following traders.
    
    parameters:
      strong_trend_ma: "sma_200"
      pullback_ma: "sma_50"
      rsi_threshold: 45
      stop_loss_atr_multiplier: 1.5
      take_profit_r_multiple: 3.0
      max_holding_days: 20
    
    entry_conditions:
      all:
        - { feature: "close", op: ">", value_feature: "sma_200" }
        - { feature: "low", op: "<=", value_feature: "sma_50" }
        - { feature: "close", op: ">=", value_feature: "sma_50" }
        - { feature: "rsi_14", op: "<", value: 45 }

  - name: "vcp_squeeze"
    description: >
      The Volatility Squeeze (VCP): Trend consolidates sideways as volume
      and volatility dry up completely. High asymmetry/explosive moves.
    
    parameters:
      bb_width_percentile_threshold: 0.10
      rvol_threshold: 0.7
      stop_loss_atr_multiplier: 2.0
      take_profit_r_multiple: 3.0
      max_holding_days: 30
    
    entry_conditions:
      all:
        - { feature: "close", op: ">", value_feature: "sma_200" }
        - { feature: "bb_width_pctile", op: "<", value: 0.10 }
        - { feature: "rvol_20", op: "<", value: 0.7 }

  # ===========================================================================
  # MOMENTUM SETUPS
  # ===========================================================================

  - name: "standard_breakout"
    description: >
      Standard Breakout: Price clears a 60-day high on >3x average volume.
      Classic momentum entry for trend initiation.
    
    parameters:
      rvol_threshold: 3.0
      rsi_threshold: 65
      stop_loss_atr_multiplier: 1.5
      take_profit_r_multiple: 2.0
      max_holding_days: 10
    
    entry_conditions:
      all:
        - { feature: "breakout_up_20", op: "==", value: true }
        - { feature: "rvol_20", op: ">", value: 3.0 }
        - { feature: "rsi_14", op: ">", value: 65 }

  - name: "gap_and_go"
    description: >
      Institutional Gap-and-Go: Catalyst-driven gap up that closes at the
      high of the day on record volume. Indicates institutional accumulation.
    
    parameters:
      gap_pct_threshold: 0.05
      rvol_threshold: 4.0
      candle_close_pct_threshold: 0.7
      stop_loss_atr_multiplier: 1.0
      take_profit_r_multiple: 2.0
      max_holding_days: 5
    
    entry_conditions:
      all:
        - { feature: "gap_pct", op: ">", value: 0.05 }
        - { feature: "rvol_20", op: ">", value: 4.0 }
        - { feature: "candle_close_pct", op: ">", value: 0.7 }

  # ===========================================================================
  # REVERSAL / EXHAUSTION SETUPS
  # ===========================================================================

  - name: "mean_reversion"
    description: >
      Mean Reversion: Price drops too far, too fast below short-term averages.
      Oversold bounce play with capitulation volume.
    
    parameters:
      dist_from_ma_threshold: -0.15
      rsi_threshold: 30
      rvol_threshold: 1.5
      stop_loss_atr_multiplier: 2.0
      take_profit_r_multiple: 2.0
      max_holding_days: 10
    
    entry_conditions:
      all:
        - { feature: "ma_dist_20", op: "<", value: -0.15 }
        - { feature: "rsi_14", op: "<", value: 30 }
        - { feature: "rvol_20", op: ">", value: 1.5 }

  - name: "double_bottom"
    description: >
      Double Bottom (Liquidity Trap): Price sweeps a previous low to trigger
      stop-losses, then reverses higher with RSI divergence.
    
    parameters:
      lookback_days: 30
      stop_loss_atr_multiplier: 1.5
      take_profit_r_multiple: 3.0
      max_holding_days: 20
    
    entry_conditions:
      all:
        - { feature: "swept_prev_low", op: "==", value: true }
        - { feature: "closed_above_prev_low", op: "==", value: true }
        - { feature: "rsi_divergence_bullish", op: "==", value: true }

  - name: "parabolic_top"
    description: >
      Parabolic Top (Short Setup): Blow-off top. Vertical price action ends
      with a "shooting star" rejection candle on highest volume of the year.
    direction: "short"
    
    parameters:
      dist_from_ma_threshold: 0.30
      rvol_threshold: 5.0
      candle_close_pct_threshold: 0.3
      stop_loss_atr_multiplier: 1.5
      take_profit_r_multiple: 2.0
      max_holding_days: 10
    
    entry_conditions:
      all:
        - { feature: "ma_dist_20", op: ">", value: 0.30 }
        - { feature: "rvol_20", op: ">", value: 5.0 }
        - { feature: "candle_close_pct", op: "<", value: 0.3 }

# =============================================================================
# PARAMETER TUNING NOTES
# =============================================================================
# 
# The following parameters should be tuned based on backtest results:
#
# 1. If Breakouts are failing:
#    - Increase rvol_threshold from 3.0 to 4.0 or 5.0
#    - Increase rsi_threshold from 65 to 70
#
# 2. If Pullbacks are stopping out too often:
#    - Increase stop_loss_atr_multiplier from 1.5 to 2.0
#    - Decrease rsi_threshold from 45 to 40
#
# 3. If Mean Reversion has low win rate:
#    - Decrease dist_from_ma_threshold from -0.15 to -0.20
#    - Decrease rsi_threshold from 30 to 25
#
# Target: Every setup should have a 60%+ win rate historically.
# =============================================================================
